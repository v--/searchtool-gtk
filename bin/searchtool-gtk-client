#!/usr/bin/env python3

import typer

import gi
gi.require_version('Gtk', '4.0')
gi.require_version('Adw', '1')


from gi.repository import Gio, GLib  # noqa: E402


app = typer.Typer()


@app.command()
def activate(mode_name: str):
    conn = Gio.bus_get_sync(
        bus_type=Gio.BusType.SESSION,
        cancellable=None
    )

    conn.call_sync(
        bus_name='net.ivasilev.SearchToolGTK',
        object_path='/net/ivasilev/SearchToolGTK',
        interface_name='net.ivasilev.SearchToolGTK',
        method_name='Activate',
        parameters=GLib.Variant('(s)', value=[mode_name]),
        reply_type=None,
        flags=Gio.DBusCallFlags.NONE,
        timeout_msec=GLib.MAXINT,
        cancellable=None
    )


@app.command()
def pick(mode_name: str):
    conn = Gio.bus_get_sync(
        bus_type=Gio.BusType.SESSION,
        cancellable=None
    )

    result_tuple = conn.call_sync(
        bus_name='net.ivasilev.SearchToolGTK',
        object_path='/net/ivasilev/SearchToolGTK',
        interface_name='net.ivasilev.SearchToolGTK',
        method_name='Pick',
        parameters=GLib.Variant('(sas)', value=[mode_name, ['a', 'b', 'c']]),
        reply_type=GLib.VariantType('(s)'),
        flags=Gio.DBusCallFlags.NONE,
        timeout_msec=GLib.MAXINT,
        cancellable=None
    )

    value: str = result_tuple[0]
    print(value)


if __name__ == '__main__':
    app()
